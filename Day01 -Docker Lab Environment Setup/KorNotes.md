# Docker 실습 환경 구축: 완전 가이드 (2025/06/12)

이 가이드는 가상머신 설치 및 구성부터 여러 Linux VM에 Docker Engine 설치까지 완전한 Docker 실습 환경 설정을 다룹니다.

---

## **1부: 초기 가상머신 설정 (VMware Workstation)**

이 부분은 VMware Workstation을 사용하여 가상머신을 설정하는 초기 단계를 자세히 설명합니다.

### **I. 필요한 파일 접근 (학원 컴퓨터에서만 작동 | 설정 파일은 카카오톡에 있음)**

* **위치:** 필요한 모든 파일은 **D 드라이브**에 있습니다.
* **공유 폴더 접근:**
    * "실행" 창을 엽니다 (**Windows 키 + R**).
    * `\\192.168.11.30`을 입력하고 엔터를 누릅니다.
    * **ID:** `cloud1`
    * **비밀번호:** `cloud1234!`
    * `김정우` 폴더로 이동한 후 `Docker` 폴더에 들어갑니다.
* **파일 복사:** 전체 `Docker` 폴더를 개인 D 드라이브로 복사합니다 (예: `D:\<당신의_이름>\Docker`).
    * *참고:* 강의실 PC를 사용하는 경우 이 파일들이 미리 다운로드되어 있는 경우가 많습니다. 개인 노트북이나 녹화 영상을 시청하는 경우에는 이 폴더 복사가 필수입니다.

### **II. VMware Workstation 16 실행 및 구성**

* **VMware Workstation 16 Pro 실행** (데스크톱에 아이콘이 없으면 Windows 검색창에 "VM"을 검색하세요).
    * *팁:* VMware Workstation 16 Pro는 현재 무료이며 `broadcom.com`(VMware를 인수한 회사)에서 다운로드할 수 있습니다.
* **초기 정리 (해당하는 경우):**
    * 왼쪽 패널에 기존 가상머신(`Client1`, `Client2`, `Server1` 등)이 보이면 **삭제**합니다.
        * VM을 우클릭하고 "제거"를 선택합니다 (또는 VM을 선택하고 'X' 버튼을 클릭).
* **새 가상머신 생성:**
    * **파일** → **새 가상머신...** 클릭
    * **사용자 정의(고급)** 구성 선택 → **다음** 클릭
    * **설치 디스크 이미지:** "나중에 운영 체제를 설치합니다" 선택 → **다음** 클릭
    * **게스트 운영 체제:** **Linux** 선택
    * **버전:** **CentOS 8 64비트** 선택
        * *(시각적: 다양한 Linux 배포판을 보여주는 드롭다운 메뉴, CentOS 8 64비트가 강조표시됨)*
    * **다음** 클릭
* **가상머신 이름 지정:**
    * **가상머신 이름:** `docker1`
    * **위치:** "찾아보기"를 클릭하고 개인 Docker 폴더 경로로 설정: `D:\<당신의_이름>\Docker\VM Image\docker1`
        * *(시각적: "docker1"이 입력되고 사용자 정의 경로가 표시된 "가상머신 이름 지정" 대화상자 스크린샷)*
    * **다음** 클릭
* **프로세서:**
    * **프로세서 수:** `1`
    * **프로세서당 코어 수:** `4` (총 4개의 가상 CPU 결과)
        * *(시각적: 프로세서당 코어 수가 4로 설정된 "프로세서" 설정 스크린샷)*
    * **다음** 클릭
* **메모리:** 메모리를 `3072 MB` (3GB)로 설정
        * *(시각적: 3072 MB로 설정된 "가상머신용 메모리" 슬라이더 스크린샷)*
    * **다음** 클릭
* **네트워크 어댑터 (연결을 위해 중요!):**
    * **NAT(네트워크 주소 변환) 사용** 선택
        * *참고:* NAT는 VM에 쉽게 인터넷 액세스를 제공하기 위해 이 실습에서 권장됩니다.
    * **다음** 클릭
* **I/O 컨트롤러 유형:** 기본 옵션(LSI Logic SAS) 유지 → **다음** 클릭
* **디스크 유형:** 기본 옵션(SCSI) 유지 → **다음** 클릭
* **디스크 용량 지정:**
    * **최대 디스크 크기(GB):** `100`
    * **가상 디스크를 여러 파일로 분할** 선택
        * *(시각적: 100GB와 "가상 디스크를 여러 파일로 분할"이 선택된 "디스크 용량 지정" 대화상자 스크린샷)*
    * **다음** 클릭
* **디스크 파일 지정:** 기본 옵션 유지 → **다음** 클릭
* **설정 검토:**
    * VM 설정 요약을 검토합니다.
    * **마침** 클릭

---

## **2부: `docker1`에 CentOS Stream 9 설치**

이 부분은 첫 번째 가상머신의 운영 체제 설치 과정을 안내합니다.

### **I. 가상머신 시작 및 설치 시작**

* **VM 시작:**
    * VMware Workstation에서 왼쪽 패널의 `docker1`을 선택합니다.
    * **이 가상머신 전원 켜기** (녹색 재생 버튼) 클릭
* **검은 화면 문제 해결 (해당하는 경우):**
    * VM 화면이 검은색으로 유지되면 일반적으로 ISO 이미지가 제대로 삽입되지 않았음을 의미합니다.
    * **VM** → **설정** → **CD/DVD (IDE)**로 이동
    * "ISO 이미지 파일 사용"이 선택되고 올바른 ISO 파일을 가리키는지 확인: `D:\<당신의_이름>\Docker\01_CentOS-Stream-9-latest-x86_64-dvd1.iso`
    * **확인**을 클릭하고 VM을 다시 시작합니다.

### **II. CentOS 설치 단계**

1.  **언어 선택:**
    * **한국어** (또는 선호하는 언어) 선택
    * **계속** 클릭

2.  **설치 요약 화면:**
    * 설치 옵션의 요약이 표시됩니다. 빨간 느낌표는 필요한 설정을 나타냅니다.
    * **호스트명 및 네트워크:**
        * "이더넷 (ens33)"을 클릭하여 **켜짐**으로 토글합니다.
        * "구성..."을 클릭 → **IPv4 설정** 탭으로 이동
        * **방법:** **수동** 선택
        * **추가** 클릭
        * **주소:** `192.168.2.10`
        * **넷마스크:** `24`
        * **게이트웨이:** `192.168.2.254`
        * **DNS 서버:** `168.126.63.1` (일반적인 한국 DNS 서버, 예: KT DNS)
        * **검색 도메인:** `example.com`
        * **저장** 클릭 → **완료** 클릭
        * **호스트명:** `localhost.localdomain`을 `docker1.example.com`으로 변경 → **적용** 클릭
    * **시간 및 날짜:**
        * "시간 및 날짜" 클릭 → **아시아/서울** (또는 현지 시간대) 선택
        * **완료** 클릭
    * **루트 계정 (루트 비밀번호):**
        * "루트 계정 (루트 비밀번호)" 클릭
        * **루트 비밀번호:** `centos`
        * **확인:** `centos`
        * **중요:** **"SSH 로그인을 위한 루트 비밀번호 허용"** 확인란을 체크합니다. ("루트 계정 잠금"은 체크하지 **마세요**).
        * **완료** 클릭
    * **사용자 생성:**
        * 이 실습에서는 **일반 사용자 생성을 건너뛸** 수 있습니다. 단순화를 위해 주로 `root` 계정을 사용합니다.
        * 사용자를 추가하지 않고 **완료** 클릭
    * **설치 대상:**
        * "설치 대상" 클릭
        * 구성한 **100GB 디스크** 선택
        * **완료** 클릭
    * **소프트웨어 선택:**
        * **GUI가 있는 서버** 선택 (그래픽 데스크톱 환경 제공)
        * **완료** 클릭

3.  **설치 시작:**
    * **설치 시작** 클릭
    * 설치 과정이 시작됩니다. 시스템 성능에 따라 일반적으로 10-15분 소요됩니다.

4.  **시스템 재부팅:**
    * 설치가 완료되면 **시스템 재부팅** 클릭

### **III. 설치 후 확인 (첫 번째 부팅)**

1.  **환영 화면:**
    * 재부팅 후 환영 화면이 표시됩니다. 개인정보보호, 온라인 계정 또는 초기 설정 화면에서 **다음**을 클릭합니다.
2.  **CentOS Stream 사용 시작:**
    * 최종 환영 화면에서 이 버튼을 클릭합니다.
3.  **루트 로그인:**
    * 로그인 화면에서 "목록에 없음?"을 클릭합니다.
    * `root`를 입력하고 엔터를 누릅니다.
    * 비밀번호 `centos`를 입력하고 엔터를 누릅니다.

4.  **초기 연결 확인 (터미널에서):**
    * **터미널** 열기 (일반적으로 하단 바의 검은색 아이콘이거나 "터미널"을 검색)
    * IP 주소 확인: `ip address`
        * `ens33`이 `192.168.2.10/24`를 표시하는지 확인
    * 게이트웨이/라우팅 확인: `ip route`
        * `default via 192.168.2.254` 확인
    * DNS 서버 확인: `cat /etc/resolv.conf`
        * `nameserver 168.126.63.1` 확인
    * Google DNS 핑: `ping -c 5 168.126.63.1`
        * 성공적인 응답을 확인해야 합니다.
    * Google NSLookup: `nslookup www.google.com`
        * `www.google.com`이 IP 주소로 성공적으로 해석되어야 합니다.
    * 브라우저 접근: Firefox 열기 (하단 바의 브라우저 아이콘)
        * `www.google.com` 또는 `www.centos.org`를 입력하여 활성 인터넷 연결을 확인합니다.

---

## **3부: 설정 스크립트로 `docker1` 구성 완료**

이 부분은 Docker 환경 설정을 간소화하기 위해 많은 일반적인 설치 후 구성을 자동화합니다.

### **I. 설정 스크립트 다운로드 및 실행**

* **설정 스크립트 다운로드:**
    * 터미널 열기 (닫혀있는 경우)
    * GitHub에서 `ping.sh` 및 `setup.sh` 스크립트 다운로드:
        * `wget -q https://raw.githubusercontent.com/ncs10322/docker/main/ping.sh`
        * `wget -q https://raw.githubusercontent.com/ncs10322/docker/main/setup.sh`
    * 파일이 다운로드되었는지 확인: `ls` (`ping.sh`와 `setup.sh`가 나열되어야 함)

* **네트워크 테스트 스크립트 실행:**
    * `sh ping.sh`
    * 이 스크립트는 자동으로 일련의 네트워크 테스트를 실행합니다 (Google DNS 핑 및 `google.com` 액세스 포함). 모든 테스트가 통과해야 합니다.

* **메인 설정 스크립트 실행:**
    * `sh setup.sh`
    * 이 스크립트는 여러 중요한 구성을 자동화합니다:
        * **SELinux:** SELinux 모드를 `permissive`로 변경 (기본적으로 'enforcing'이며 때때로 Docker와 충돌할 수 있음)
            * *재부팅 후 확인:* `sestatus` (현재 모드가 `permissive`여야 함)
        * **FirewallD:** FirewallD 서비스 비활성화
            * *재부팅 후 확인:* `systemctl status firewalld` (`inactive (dead)` 표시)
        * **GNOME 조정 및 확장:** 데스크톱 사용자 정의를 위한 `gnome-tweaks` 및 `gnome-extensions` 패키지 설치
        * **메모리 및 화면 설정:** 방해를 방지하기 위해 절전/최대절전 및 화면 보호기 비활성화
        * **`.vimrc` 파일:** 기본 Vim 편집기 구성(예: 줄 번호, 어두운 배경, 구문 강조)으로 `.vimrc` 파일 생성
            * *확인:* `cat ~/.vimrc`
        * **`.bashrc` 별칭 및 PS1:** 유용한 별칭 추가 (예: `rm -i`, `cp -i`, `mv -i`, `ls --color=auto --time-style=long-iso`) 및 셸 프롬프트(`PS1`) 사용자 정의
            * *확인:* `cat ~/.bashrc`
        * **`/etc/hosts`:** `docker1`과 `docker2` 항목을 포함하도록 `/etc/hosts` 파일 수정
        * **EPEL 및 Git:** EPEL 저장소 및 Git 설치
    * **중요:** `setup.sh` 완료 후 시스템이 자동으로 **재부팅**됩니다.

---

## **4부: `docker2` 생성 (`docker1` 복제)**

이 부분은 첫 번째 가상머신을 복제하여 두 번째 가상머신을 효율적으로 생성하는 방법과 네트워크 및 호스트명을 적절히 구성하는 방법을 자세히 설명합니다.

### **I. 복제를 위한 `docker1` 준비**

* **`docker1` 전원 끄기:**
    * VMware Workstation에서 왼쪽 패널의 `docker1`을 우클릭
    * **전원** → **전원 끄기** 선택
        * *(VM 내부 터미널에서 대안):* `init 0` (또는 `poweroff`)를 입력하고 엔터를 누릅니다. 복제하기 전에 VM을 완전히 끄는 것이 중요합니다.

### **II. `docker1`을 `docker2`로 복제**

* **복제 마법사 시작:**
    * VMware Workstation에서 왼쪽 패널의 `docker1`을 우클릭
    * **관리** → **복제...** 선택
    * "가상머신 복제 마법사에 오신 것을 환영합니다" 화면에서 **다음** 클릭
* **복제 유형 선택:**
    * **전체 복제 생성** 선택
        * *설명:* **전체 복제**는 완전히 독립적인 사본을 생성하며, 이는 이 Docker 설정과 같은 별도의 실습 환경에 이상적입니다. 연결된 복제는 더 작지만 원래 VM에 의존합니다.
    * **다음** 클릭
* **`docker2`의 이름 및 위치:**
    * **가상머신 이름:** `docker2`
    * **위치:** "찾아보기"를 클릭하고 경로를 `D:\<당신의_이름>\Docker\VM Image\docker2`로 설정
        * *(시각적: 마법사에서 "가상머신 이름: docker2"와 사용자 정의 위치를 보여주는 스크린샷)*
    * **마침** 클릭
* **복제 대기:**
    * 복제 과정이 시작됩니다. 시스템 성능에 따라 몇 분 소요될 수 있습니다.

### **III. 복제 후 `docker2` 구성**

1.  **`docker2` 전원 켜기**
2.  **`root`로 로그인** (비밀번호: `centos`)
3.  **호스트명 변경 (고유 식별을 위해 필수):**
    * `hostnamectl set-hostname docker2.example.com`
    * `exit`를 입력하고 엔터를 누릅니다 (로그아웃하고 다시 로그인하여 호스트명 변경을 터미널 프롬프트에 적용)
    * `root`로 다시 로그인
    * *확인:* 터미널 프롬프트가 이제 `root@docker2 ~]#`을 표시해야 합니다.
        * *(시각적: `hostnamectl set-hostname docker2.example.com` 명령과 새 프롬프트를 보여주는 터미널)*
4.  **IP 주소 변경 (네트워크 고유성을 위해 중요):**
    * `docker1`은 IP 주소 `192.168.2.10`을 가지므로 `docker2`는 같은 네트워크 내에서 다른 고유한 IP가 필요합니다.
    * `nmtui`를 입력하고 엔터를 누릅니다 (네트워크 구성을 위한 텍스트 기반 사용자 인터페이스 열기)
    * "연결 편집" 선택 → `ens33` 강조 표시 → 엔터 누르기 (**편집**하기 위해)
    * "IPv4 구성" 섹션으로 이동 → **수동** 선택
    * "주소"로 이동 → `192.168.2.10/24` 강조 표시 → **삭제** 누르기
    * **추가** 클릭
    * **주소:** `192.168.2.20/24` (`docker2`의 새 IP)
    * **게이트웨이:** `192.168.2.254` (`docker1`과 같은 게이트웨이 유지)
    * **DNS 서버:** `168.126.63.1` (같은 DNS 서버 유지)
    * **검색 도메인:** `example.com` (같은 검색 도메인 유지)
    * *(시각적: IP가 `192.168.2.20`으로 변경된 `nmtui`의 IPv4 설정 스크린샷)*
    * "확인"으로 이동 → "연결 활성화" 선택 → `ens33` 선택 (엔터를 눌러 비활성화한 후 다시 엔터를 눌러 활성화) → "뒤로" 선택 → "종료" 선택
    * *확인:* `ip address`를 입력하고 엔터를 누릅니다. `ens33`이 이제 `192.168.2.20`을 표시하는지 확인합니다.
    * *`docker1`에 대한 연결성 테스트 (`docker2`에서):* `ping -c 5 192.168.2.10` (이것은 성공적으로 `docker1`을 핑해야 함)
5.  **`/etc/hosts` 업데이트 (VM 간 적절한 이름 해석을 위해):**
    * `gedit /etc/hosts &` (백그라운드에서 그래픽 텍스트 편집기 열기)
    * 다음 줄을 추가합니다 (`docker1.example.com` 항목 아래):
        `192.168.2.20 docker2.example.com docker2`
    * 파일을 저장하고 `gedit`을 닫습니다.
    * *확인:* `cat /etc/hosts`
    * *`docker2`에서 이름 해석 테스트:* `ping docker1.example.com` (이제 올바르게 해석되고 `192.168.2.10`을 핑해야 함)

---

## **5부: Docker Engine 설치**

이 마지막 부분은 새로 준비된 Linux 가상머신에 Docker Engine을 설치하는 과정을 안내합니다.

### **I. Docker 설치 단계 검색**

* **출처:** 가장 최신이고 신뢰할 수 있는 설치 지침을 위해 항상 공식 Docker 문서를 참조하세요.
    * Google에서 "Docker install CentOS" 검색
    * *직접 링크:* [https://docs.docker.com/engine/install/centos/](https://docs.docker.com/engine/install/centos/)
    * *(시각적: CentOS 설치용 Docker 문서 페이지 스크린샷)*

### **II. Docker Engine 설치 단계 (`docker1`과 `docker2` 모두)**

**먼저 `docker1`에서 이 단계들을 수행한 후 `docker2`에서 반복하세요.**

1.  **Docker 저장소 추가:**
    * 이 단계는 공식 Docker 저장소를 시스템의 패키지 관리자에 추가합니다.
    * `sudo yum -y install yum-utils` (시스템에 없는 경우 `yum-utils` 설치. 이 패키지는 `yum-config-manager` 유틸리티를 제공함)
        * *참고:* CentOS Stream 9는 주로 `dnf`를 패키지 관리자로 사용하지만, `yum` 명령은 종종 `dnf`의 별칭입니다.
    * `sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo`
    * *확인:* `yum repolist` (출력에서 `docker-ce-stable`이 나열되어야 함)

2.  **편의 스크립트 다운로드 (선택사항이지만 권장):**
    * 이 스크립트는 종속성과 구성을 처리하여 Docker Engine 설치 과정을 간소화합니다.
    * `curl -fsSL https://get.docker.com -o get-docker.sh`
        * `curl`: URL 구문으로 데이터를 전송하는 명령줄 도구
        * `-fsSL`: 무음, 빠른 실패, 리디렉션 따라가기 플래그
        * `https://get.docker.com`: Docker 설치 스크립트 URL
        * `-o get-docker.sh`: 다운로드된 스크립트를 `get-docker.sh`로 저장
    * *확인:* `ls` (현재 디렉터리에 `get-docker.sh`가 있는지 확인)
    * *스크립트가 수행할 작업 미리보기 (선택사항이지만 좋은 관행):* `sh get-docker.sh --dry-run`

3.  **Docker 설치 스크립트 실행:**
    * 다운로드된 스크립트를 실행하여 Docker Engine을 설치합니다.
    * `sh get-docker.sh`
    * 이 스크립트는 Docker Engine, Containerd(컨테이너 런타임) 및 Docker Compose(다중 컨테이너 Docker 애플리케이션을 정의하고 실행하는 도구)를 설치합니다.

4.  **Docker 서비스 시작 및 활성화:**
    * 설치 후 Docker 서비스를 시작하고 부팅 시 자동으로 시작되도록 구성해야 합니다.
    * `sudo systemctl enable --now docker`
        * `systemctl enable`: Docker 서비스가 시스템 부팅 시 자동으로 시작되도록 구성
        * `--now`: 활성화한 후 즉시 Docker 서비스 시작
    * *확인:* `sudo systemctl status docker`
        * `Active: active (running)` 및 `enabled`를 나타내는 출력이 표시되어야 합니다.
        * *(시각적: `active (running)` 및 `enabled`가 강조표시된 `systemctl status docker` 출력 스크린샷)*

5.  **Docker 설치 테스트 (Hello World):**
    * 간단한 테스트 컨테이너를 실행하여 Docker가 올바르게 작동하는지 확인합니다.
    * `docker container run hello-world`
    * 이 명령은 여러 작업을 수행합니다:
        * Docker Hub에서 `hello-world` 이미지를 다운로드 (로컬에 없는 경우)
        * 해당 이미지를 기반으로 새 컨테이너 생성
        * 컨테이너 실행
        * 컨테이너는 "Hello from Docker!" 메시지를 출력하는 작은 프로그램을 실행한 후 종료
        * *(시각적: "Hello from Docker!" 메시지를 보여주는 터미널 출력)*

6.  **Docker 설치 테스트 (Nginx - `docker1`용):**
    * 이 테스트는 더 기능적인 컨테이너(웹 서버)를 실행하고 호스트 머신에서 액세스하는 것을 보여줍니다.
    * **`docker1`에서만:** `docker container run -p 80:80 nginx`
        * `docker container run`: 새 컨테이너를 생성하고 실행하는 명령
        * `-p 80:80`: `docker1` VM(호스트)의 포트 80을 Nginx 컨테이너 내부의 포트 80에 매핑
        * `nginx`: 사용할 Docker 이미지 이름(Nginx 웹 서버)
    * **Windows에서 액세스:** Windows 호스트 머신에서 웹 브라우저를 엽니다.
        * `http://192.168.2.10/`로 이동합니다. 기본 Nginx 환영 페이지가 표시되어야 합니다.
    * *참고:* `docker container run -p 80:80 nginx` 명령은 터미널 전경에서 Nginx 컨테이너를 계속 실행합니다. VM에서 계속 작업하려면 **새 터미널 창**을 여세요(예: Ctrl+Shift+T).

### **III. 최종 실습 마무리**

* **`docker2`에서 Docker Engine 설치 반복:**
    * `docker2` VM으로 이동합니다.
    * **5부의 1~5단계**를 모두 수행합니다(Docker Engine 설치, 시작/활성화, `hello-world` 테스트).
    * 지금은 `docker2`에서 Nginx를 실행할 필요는 없지만 원한다면 실행할 수 있습니다.

* **두 VM 모두 전원 끄기:**
    * 모든 단계를 완료하고 두 VM 모두에서 Docker가 실행되는 것을 확인한 후, 현재 상태를 저장하기 위해 **두 VM을 모두 끄는 것이 중요**합니다.
    * **각 VM의 터미널에서:** `init 0` (또는 `poweroff`)를 입력하고 엔터를 누릅니다.
    * *또는 VMware Workstation에서:* 왼쪽 패널에서 VM을 우클릭 → **전원** → **전원 끄기**

---

## **추가 팁 및 참고사항**

### **네트워크 구성 요약**
- `docker1`: IP `192.168.2.10`, 호스트명 `docker1.example.com`
- `docker2`: IP `192.168.2.20`, 호스트명 `docker2.example.com`
- 게이트웨이: `192.168.2.254`
- DNS: `168.126.63.1`

### **주요 명령어 참고**
- **VM 상태 확인:** `systemctl status docker`
- **네트워크 확인:** `ip address`, `ip route`
- **연결성 테스트:** `ping docker1.example.com`, `ping docker2.example.com`
- **Docker 테스트:** `docker container run hello-world`

### **문제 해결**
- **VM이 시작되지 않는 경우:** ISO 파일 경로를 확인하고 VM 설정에서 올바르게 연결되어 있는지 확인
- **네트워크 연결 문제:** `nmtui`를 사용하여 네트워크 설정을 다시 확인
- **Docker 서비스 문제:** `sudo systemctl restart docker`로 서비스 재시작

이제 완전한 Docker 실습 환경이 구축되었습니다! 두 개의 독립적인 CentOS Stream 9 VM에서 Docker Engine이 실행되고 있으며, 컨테이너 기반 애플리케이션 개발 및 테스트를 위한 준비가 완료되었습니다.