
# Docker Networking, Container Management, Portainer, and Resource Control. (2025/06/25)

### **제9장: Docker 네트워크 운용**

#### **1. Docker 네트워크 유형 (`bridge`, `host`, `none`)**

Docker는 컨테이너 통신을 처리하기 위해 기본적으로 세 가지 네트워크 드라이버를 제공합니다.

| 드라이버 | 설명 | 주요 사용 사례 |
| :--- | :--- | :--- |
| **`bridge`** | **(기본값)** 사설 내부 네트워크를 생성합니다. Docker가 IP 주소, 라우팅, 게이트웨이를 관리하며 컨테이너에 `172.17.0.x` 같은 IP를 할당합니다. | 서로 통신하거나 외부와 통신해야 하는 독립 실행형 컨테이너에 가장 일반적으로 사용됩니다. |
| **`host`** | 컨테이너가 호스트의 네트워크 스택을 공유합니다. 컨테이너는 별도의 IP를 할당받지 않고 호스트의 IP를 직접 사용합니다. | 네트워크 성능이 매우 중요하고 컨테이너와 호스트 간의 네트워크 분리가 필요 없을 때 사용합니다. |
| **`none`** | 컨테이너는 자신만의 네트워크 스택을 가지지만, 루프백(`lo`) 인터페이스 외에는 아무것도 구성되지 않아 네트워크와 완전히 격리됩니다. | 네트워크 접근이 전혀 필요 없는 컨테이너나 특수한 맞춤형 네트워크를 설정할 때 사용됩니다. |

**기본 브리지 네트워크 (`docker0`) 다이어그램**

아래 다이어그램은 컨테이너가 기본 `docker0` 브리지를 통해 호스트 및 외부 네트워크와 통신하는 구조를 보여줍니다.

```
+------------------+     +--------------------------+     +-------------------+
|     컨테이너      |     |        Docker 호스트       |     |   외부 네트워크    |
|                  |     |                          |     |    (예: 인터넷)   |
|  eth0@ifXX      +<--->+  docker0 (172.17.0.1)  +<--->+    ens33 (호스트 IP) |
| (172.17.0.2)     |     | (가상 브리지/게이트웨이) |     |                   |
+------------------+     +--------------------------+     +-------------------+
```

#### **2. 사용자 정의 브리지 네트워크 (Custom Bridge Networks)**

애플리케이션 구조와 보안을 향상시키기 위해 직접 격리된 브리지 네트워크를 생성할 수 있습니다.

**주요 명령어:**

| 명령어 | 설명 |
| :--- | :--- |
| `docker network create <이름>` | 새로운 브리지 네트워크를 생성합니다. |
| `docker network inspect <이름>` | 네트워크의 상세 정보(서브넷, 게이트웨이, 연결된 컨테이너 등)를 확인합니다. |
| `docker network connect <네트워크> <컨테이너>` | 실행 중인 컨테이너를 다른 네트워크에 추가로 연결합니다. |
| `docker network disconnect <네트워크> <컨테이너>`| 컨테이너와 네트워크의 연결을 끊습니다. |
| `docker network rm <이름>` | 네트워크를 삭제합니다. (컨테이너가 연결되어 있으면 삭제 불가) |
| `docker network prune` | 사용하지 않는 모든 네트워크를 한 번에 삭제합니다. |

**네트워크 통신 실습 다이어그램**

아래는 두 개의 격리된 네트워크(`alpinenet`, `bridge`)를 `alpine3`라는 멀티홈(multi-homed) 컨테이너를 라우터로 사용하여 통신시키는 과정을 시각화한 다이어그램입니다.

```
       +----------------------------------+          +----------------------------------+
       |     Docker 호스트 (br-...)       |          |       Docker 호스트 (docker0)      |
       |     게이트웨이: 172.18.0.1/16      |          |     게이트웨이: 172.17.0.1/16      |
       +----------------|-----------------+          +----------------|-----------------+
                        |                                          |
  +---------------------|-----------------------+    +---------------|--------------------+
  |  네트워크: alpinenet (172.18.0.0/16)        |    |  네트워크: bridge (172.17.0.0/16)    |
  +---------------------------------------------+    +------------------------------------+
    |         |                   |                    |                   |
.2  |      .3 |                .4 |                 .2 |                .3 |
[eth0]   [eth0]             [eth1] <----[alpine3]----> [eth0]             [eth0]
+---------+ +---------+         +----------------+         +---------+
| alpine1 | | alpine2 |         |  (멀티홈 컨테이너) |         | alpine4 |
+---------+ +---------+         +----------------+         +---------+

# 통신 경로:
# alpine1/2 <--> alpine3(eth1) <--> alpine3(eth0) <--> alpine4
# (alpine1/2와 alpine4 컨테이너 내부에 수동으로 라우팅 경로를 추가해야 함)
```

-----

### **제10장: Docker 컨테이너 운용**

#### **1. 레거시 컨테이너 연결 (`--link`)**

> **중요:** `--link` 옵션은 **레거시(legacy) 기능**입니다. 최신 버전의 Docker에서는 사용이 권장되지 않으며, 사용자 정의 브리지 네트워크 사용이 표준입니다.

  - `--link` 플래그는 수신 컨테이너의 `/etc/hosts` 파일에 호스트 정보를 자동으로 추가하여 IP 주소 없이 이름으로 통신할 수 있게 해줍니다.

**예제:**

```bash
# MySQL 데이터베이스 컨테이너 생성
docker container run -d --name mysql -e MYSQL_ROOT_PASSWORD=password mysql:5.7

# WordPress 컨테이너를 생성하고 MySQL 컨테이너에 연결
docker container run -d --name wordpress --link mysql -p 80:80 wordpress:5
```

  - 이제 `wordpress` 컨테이너는 `mysql`이라는 호스트 이름을 `mysql` 컨테이너의 IP 주소로 해석할 수 있습니다.

#### **2. 컨테이너 관리 명령어**

컨테이너의 생명주기를 관리하는 필수 명령어들입니다.

| 명령어 | 설명 |
| :--- | :--- |
| `docker container attach` | 실행 중인 컨테이너의 메인 프로세스(PID 1)에 터미널을 연결합니다. **메인 프로세스가 쉘일 경우 `exit`하면 컨테이너가 종료됩니다.** |
| `docker container exec` | **(권장)** 실행 중인 컨테이너 안에서 새로운 명령(프로세스)을 실행합니다. `exec`로 생성된 쉘에서 `exit`해도 컨테이너는 종료되지 않습니다. |
| `docker container top` | 컨테이너 내부에서 실행 중인 프로세스 목록을 보여줍니다. |
| `docker container stats` | 컨테이너의 리소스(CPU, 메모리, 네트워크 I/O) 사용량을 실시간 스트림으로 보여줍니다. |
| `docker container port` | 컨테이너의 포트 매핑 정보를 나열합니다. |
| `docker container rename` | 컨테이너의 이름을 변경합니다. |
| `docker container cp` | 호스트와 컨테이너 간에 파일이나 폴더를 복사합니다. |
| `docker container diff` | 컨테이너 생성 이후 파일 시스템에서 변경된 내역(추가, 변경, 삭제)을 보여줍니다. |
| `docker container logs` | 컨테이너의 로그를 가져옵니다. `-f` 플래그를 사용하면 실시간으로 로그를 확인할 수 있습니다. |

-----

### **제11장: Docker 리소스 제어 및 모니터링**

#### **1. 리소스 제한이 필요한 이유**

  - 기본적으로 컨테이너는 호스트의 모든 하드웨어 자원(CPU, 메모리 등)을 제한 없이 사용할 수 있습니다.
  - 하나의 컨테이너가 자원을 과도하게 사용하면 동일 호스트의 다른 컨테이너에 악영향을 줄 수 있으므로, 리소스를 제한하는 것이 중요합니다.

#### **2. 리소스 제한 옵션 (`docker run`)**

`docker run` 명령어 실행 시 다양한 옵션으로 컨테이너의 리소스를 제어할 수 있습니다.

**메모리 제한 옵션:**

| 플래그 | 설명 |
| :--- | :--- |
| `-m` 또는 `--memory` | 메모리 사용량의 하드 리밋(hard limit)을 설정합니다. (예: `512m`, `1g`). 초과 시 OOM(Out-of-Memory) 에러로 컨테이너가 종료됩니다. |
| `--memory-swap` | 컨테이너가 사용할 수 있는 총 메모리+스왑의 양을 설정합니다. `-1`로 설정 시 스왑을 무제한으로 사용합니다. |
| `--oom-kill-disable` | 메모리 부족 시 커널이 컨테이너를 강제 종료하지 않도록 설정합니다. **(호스트가 불안정해질 수 있어 주의 필요)**. |

**CPU 제한 옵션:**

| 플래그 | 설명 |
| :--- | :--- |
| `--cpus` | 컨테이너가 사용할 수 있는 CPU 코어의 수를 제한합니다. (예: `"1.5"`) |
| `--cpu-shares` | CPU 사용에 대한 상대적인 가중치를 설정합니다. 기본값은 `1024`이며, 숫자가 높을수록 더 많은 CPU 시간을 할당받습니다. |
| `--cpuset-cpus` | 컨테이너를 특정 CPU 코어에 고정(pinning)합니다. (예: `"0,1"`) |

**블록 I/O 제한 옵션:**

| 플래그 | 설명 |
| :--- | :--- |
| `--device-read-bps` | 특정 장치의 읽기 속도를 초당 바이트 수로 제한합니다. (예: `/dev/sda:1mb`) |
| `--device-write-bps` | 쓰기 속도를 초당 바이트 수로 제한합니다. |
| `--device-read-iops` | 초당 읽기 IO 작업 수(IOPS)를 제한합니다. |
| `--device-write-iops` | 초당 쓰기 IO 작업 수(IOPS)를 제한합니다. |

-----

### **GUI 관리 도구: Portainer (포테이너)**

Portainer는 Docker 환경을 관리하기 위한 강력한 웹 기반 UI를 제공합니다.

#### **1. Portainer 배포**

Portainer 역시 Docker 컨테이너로 실행되며, Docker 데몬을 관리하기 위해 Docker 소켓 파일(`/var/run/docker.sock`)에 접근해야 합니다.

```bash
# Portainer Community Edition 실행 명령어
docker container run -d \
  -p 8000:8000 -p 9443:9443 \
  --name=portainer \
  --restart=always \
  -v /var/run/docker.sock:/var/run/docker.sock \
  -v portainer_data:/data \
  portainer/portainer-ce:latest
```

| 플래그/인자 | 목적 |
| :--- | :--- |
| `-d` | 컨테이너를 백그라운드(detached) 모드로 실행합니다. |
| `-p 9443:9443` | Portainer 웹 UI 접속을 위해 호스트의 9443 포트를 컨테이너의 9443 포트와 연결합니다. |
| `--name=portainer` | 컨테이너에 `portainer`라는 이름을 지정합니다. |
| `--restart=always` | 컨테이너가 중지되거나 호스트가 재부팅될 때 자동으로 다시 시작되도록 설정합니다. |
| `-v /var/run/docker.sock...` | **(필수)** 호스트의 Docker 소켓을 컨테이너에 마운트하여 Portainer가 Docker를 제어할 수 있게 합니다. |
| `-v portainer_data:/data` | Portainer 자체의 설정 및 데이터를 영구적으로 저장하기 위해 `portainer_data`라는 이름의 볼륨을 생성 및 사용합니다. |
| `portainer/portainer-ce:latest`| 사용할 Portainer 이미지(커뮤니티 에디션, 최신 버전)를 지정합니다. |

#### **2. Portainer 사용법**

  - 웹 브라우저에서 `https://<호스트-IP>:9443` 주소로 접속합니다.
  - 초기 접속 시 `admin` 계정의 비밀번호를 설정합니다.
  - 이후 로컬 Docker 환경에 연결하여 다음 항목들을 그래픽 인터페이스로 편리하게 관리할 수 있습니다.
      - **컨테이너**: 시작, 중지, 재시작, 로그 보기, 콘솔 접속(`exec`) 등
      - **이미지**: Docker Hub에서 이미지 가져오기(Pull), 기존 이미지 확인 및 삭제
      - **네트워크**: 네트워크 목록 확인, 생성 및 삭제
      - **볼륨**: 볼륨 목록 확인, 생성 및 삭제
      - **대시보드**: Docker 환경의 전반적인 상태를 한눈에 파악